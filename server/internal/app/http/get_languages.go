package http

import (
	"encoding/json"
	"inzarubin80/MemCode/internal/app/uhttp"
	"inzarubin80/MemCode/internal/model"
	"net/http"
)

type GetLanguagesHandler struct {
	name string
}

type LanguageResponse struct {
	Name    string `json:"name"`
	Value   string `json:"value"`
	IconSVG string `json:"icon_svg"`
}

func NewGetLanguagesHandler(name string) *GetLanguagesHandler {
	return &GetLanguagesHandler{
		name: name,
	}
}

func (h *GetLanguagesHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {
	supportedLanguages := model.GetSupportedLanguages()

	languages := make([]LanguageResponse, len(supportedLanguages))
	for i, lang := range supportedLanguages {
		languages[i] = LanguageResponse{
			Name:    getLanguageDisplayName(lang),
			Value:   string(lang),
			IconSVG: getLanguageSVGIcon(lang),
		}
	}

	jsonData, err := json.Marshal(languages)
	if err != nil {
		uhttp.SendErrorResponse(w, http.StatusInternalServerError, err.Error())
		return
	}

	uhttp.SendSuccessfulResponse(w, jsonData)
}

// getLanguageDisplayName возвращает отображаемое имя для языка программирования
func getLanguageDisplayName(lang model.ProgrammingLanguage) string {
	switch lang {
	case model.LanguagePython:
		return "Python"
	case model.LanguageJavaScript:
		return "JavaScript"
	case model.LanguageJava:
		return "Java"
	case model.LanguageCpp:
		return "C++"
	case model.LanguageCSharp:
		return "C#"
	case model.LanguageGo:
		return "Go"
	case model.LanguageRust:
		return "Rust"
	case model.LanguageKotlin:
		return "Kotlin"
	case model.LanguageSwift:
		return "Swift"
	case model.LanguageTypeScript:
		return "TypeScript"
	case model.Language1C:
		return "1С"
	default:
		return string(lang)
	}
}

// getLanguageSVGIcon возвращает SVG-код для иконки языка
func getLanguageSVGIcon(lang model.ProgrammingLanguage) string {
	switch lang {
	case model.Language1C:
		return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="32" height="32" rx="8" fill="#E30613"/>
<text x="16" y="21" text-anchor="middle" font-family="Arial" font-size="18" font-weight="bold" fill="white">1C</text>
</svg>`
	case model.LanguagePython:
		return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M15.885 7.968C14.867 7.968 14.039 8.805 14.039 9.835C14.039 10.865 14.867 11.693 15.885 11.693C16.914 11.693 17.742 10.865 17.742 9.835C17.742 8.805 16.914 7.968 15.885 7.968ZM11.989 4C8.694 4 6 6.694 6 9.989V14.01H10.01V13.01H7C6.448 13.01 6 12.562 6 12.01V9.989C6 7.797 7.797 6 9.989 6H22.01C24.203 6 26 7.797 26 9.989V22.01C26 24.203 24.203 26 22.01 26H9.989C7.797 26 6 24.203 6 22.01V19.99H10.01V21.99H6V22.01C6 25.306 8.694 28 11.989 28H22.01C25.306 28 28 25.306 28 22.01V9.989C28 6.694 25.306 4 22.01 4H11.989ZM9.99 19.99C9.99 21.01 10.98 21.99 12 21.99H20.01C21.03 21.99 22.01 21.01 22.01 19.99V12.01C22.01 10.99 21.03 10.01 20.01 10.01H12C10.98 10.01 9.99 10.99 9.99 12.01V19.99ZM15.885 20.307C14.867 20.307 14.039 21.135 14.039 22.165C14.039 23.195 14.867 24.032 15.885 24.032C16.914 24.032 17.742 23.195 17.742 22.165C17.742 21.135 16.914 20.307 15.885 20.307Z" fill="#3776AB"/>
<path d="M20.01 12.01H12V19.99H20.01V12.01Z" fill="#FFD43B"/>
</svg>`
	case model.LanguageJavaScript:
		return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="32" height="32" rx="8" fill="#F7DF1E"/>
<path d="M20.833 24.563C21.499 25.573 22.333 26.333 23.833 26.333C25.083 26.333 25.833 25.75 25.833 24.813C25.833 23.708 25.083 23.333 23.833 22.708L23.333 22.458C21.333 21.5 20.083 20.375 20.083 18.208C20.083 16.208 21.666 14.625 23.833 14.625C25.416 14.625 26.583 15.188 27.416 16.813L25.333 18.313C24.833 17.438 24.333 17.125 23.833 17.125C23.333 17.125 22.916 17.542 22.916 18.042C22.916 18.958 23.333 19.333 24.5 19.875L25 20.125C27.25 21.25 28.5 22.333 28.5 24.542C28.5 26.875 26.583 28.333 23.916 28.333C21.333 28.333 19.833 27.083 19.083 25.563L20.833 24.563ZM10.5 24.708C11 25.542 11.5 26.208 12.5 26.208C13.5 26.208 14 25.833 14 24.542V14.292H17.25V24.667C17.25 27.375 15.75 28.667 13.083 28.667C10.833 28.667 9.583 27.625 8.75 26.375L10.5 24.708Z" fill="black"/>
</svg>`
	case model.LanguageGo:
		return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M18.115 13.125L17.307 13.932L20.432 17.057L17.307 20.182L18.115 20.99L21.865 17.24L18.115 13.125Z" fill="#00ADD8"/>
<path d="M13.885 20.99L14.693 20.182L11.568 17.057L14.693 13.932L13.885 13.125L10.135 17.24L13.885 20.99Z" fill="#00ADD8"/>
<path d="M16 6C10.477 6 6 10.477 6 16C6 21.523 10.477 26 16 26C21.523 26 26 21.523 26 16C26 10.477 21.523 6 16 6ZM16 24.25C11.451 24.25 7.75 20.549 7.75 16C7.75 11.451 11.451 7.75 16 7.75C20.549 7.75 24.25 11.451 24.25 16C24.25 20.549 20.549 24.25 16 24.25Z" fill="#00ADD8"/>
<path d="M18.5 17C18.5 17.828 17.828 18.5 17 18.5C16.172 18.5 15.5 17.828 15.5 17C15.5 16.172 16.172 15.5 17 15.5C17.828 15.5 18.5 16.172 18.5 17Z" fill="#00ADD8"/>
</svg>`
	case model.LanguageJava:
		return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12.238 21.999C11.387 23.147 12.238 24.147 13.238 24.772C14.574 25.584 16.574 25.772 16.574 25.772C16.574 25.772 16.238 27.522 14.738 28.397C12.738 29.522 10.387 29.147 9.238 28.772C8.988 28.647 9.113 28.397 9.363 28.397C11.113 27.647 12.113 26.772 16.238 27.147C15.113 28.147 13.113 28.772 11.113 28.397C8.113 27.897 6.113 25.522 8.113 22.397C8.738 21.397 10.113 20.522 11.738 20.147C12.113 20.022 12.488 20.272 12.238 20.647L12.238 21.999Z" fill="#5382A1"/>
<path d="M23.488 26.522C25.488 24.897 26.238 22.772 26.488 20.272C26.613 19.397 26.613 18.647 26.613 17.897C26.613 17.647 26.363 17.522 26.113 17.647C25.113 18.147 24.238 18.522 23.613 18.772C22.113 19.397 21.488 18.272 21.113 17.522C22.863 16.772 24.613 15.772 25.113 13.522C25.613 11.022 24.238 9.272 24.238 9.272C24.238 9.272 25.363 10.397 26.113 12.397C26.863 14.522 26.363 16.522 25.863 17.272C26.738 15.147 26.238 13.397 25.488 12.397C22.488 15.022 24.113 18.147 24.988 18.897C25.863 19.647 27.613 20.397 26.613 23.147C25.738 25.772 23.488 26.522 23.488 26.522Z" fill="#5382A1"/>
<path d="M15.488 7.772C15.488 7.772 12.863 10.147 14.613 12.147C16.488 14.272 13.363 15.147 13.363 15.147C13.363 15.147 11.238 14.272 12.238 12.272C13.113 10.522 15.113 9.897 15.488 7.772Z" fill="#5382A1"/>
<path d="M22.738 28.522C26.488 27.897 28.113 25.397 27.863 23.147C27.863 22.897 27.613 22.772 27.363 22.897C25.363 23.772 24.613 24.522 21.988 23.647C21.863 23.522 21.613 23.647 21.613 23.772C21.738 26.147 24.113 27.522 22.738 28.522Z" fill="#5382A1"/>
<path d="M10.113 22.522C6.238 23.272 8.113 25.897 10.113 26.272C7.988 27.147 5.863 26.147 5.363 24.397C4.863 22.647 6.113 21.897 7.613 21.522C8.238 21.397 8.988 21.272 9.863 21.272C10.113 21.272 10.238 21.522 10.113 21.772V22.522Z" fill="#5382A1"/>
<path d="M15.488 16.147C18.238 16.897 22.113 16.397 24.613 15.272C24.863 15.147 24.863 14.772 24.613 14.647C22.363 13.397 18.738 13.647 15.613 13.147C15.363 13.147 15.238 13.397 15.238 13.647C15.363 14.897 15.488 15.522 15.488 16.147Z" fill="#5382A1"/>
<path d="M14.613 18.522C17.488 19.147 21.238 18.522 23.238 17.522C23.488 17.397 23.488 17.022 23.238 16.897C21.113 15.772 17.488 16.147 14.488 16.522C14.238 16.522 14.113 16.772 14.113 17.022C14.113 17.522 14.238 18.147 14.613 18.522Z" fill="#5382A1"/>
</svg>`
	case model.LanguageCpp:
		return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M14.125 7.75H17.875V9.25H14.125V7.75Z" fill="#00599C"/>
<path d="M7 13.75V18.25H9.25V15.25H11.5V18.25H13.75V13.75H7Z" fill="#00599C"/>
<path d="M14.5 13.75V15.25H16.75V16.75H14.5V18.25H18.25V16.75H16.75V15.25H18.25V13.75H14.5Z" fill="#00599C"/>
<path d="M20.5 13.75V15.25H22.75V18.25H25V13.75H20.5Z" fill="#00599C"/>
<path d="M7 19.75V24.25H9.25V21.25H11.5V24.25H13.75V19.75H7Z" fill="#00599C"/>
<path d="M14.5 19.75V24.25H18.25V22.75H16.75V21.25H18.25V19.75H14.5ZM16.75 22.75H14.5V21.25H16.75V22.75Z" fill="#00599C"/>
<path d="M20.5 19.75V21.25H22.75V22.75H20.5V24.25H25V19.75H20.5Z" fill="#00599C"/>
<path d="M16 7C10.477 7 6 11.477 6 17C6 22.523 10.477 27 16 27C21.523 27 26 22.523 26 17C26 11.477 21.523 7 16 7ZM16 25.5C11.312 25.5 7.5 21.688 7.5 17C7.5 12.312 11.312 8.5 16 8.5C20.688 8.5 24.5 12.312 24.5 17C24.5 21.688 20.688 25.5 16 25.5Z" fill="#00599C"/>
</svg>`
	case model.LanguageCSharp:
		return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M16 7C10.477 7 6 11.477 6 17C6 22.523 10.477 27 16 27C21.523 27 26 22.523 26 17C26 11.477 21.523 7 16 7Z" fill="#68217A"/>
<path d="M21 15.5H19.5V14H18V15.5H16.5V17H18V18.5H19.5V17H21V15.5Z" fill="white"/>
<path d="M23 15.5H24.5V17H23V18.5H21.5V17H20V15.5H21.5V14H23V15.5Z" fill="white"/>
<path d="M13 17C13 14.791 14.791 13 17 13H19.5V14.5H17C15.621 14.5 14.5 15.621 14.5 17C14.5 18.379 15.621 19.5 17 19.5H19.5V21H17C14.791 21 13 19.209 13 17Z" fill="white"/>
<path d="M20 17C20 19.209 18.209 21 16 21H13.5V19.5H16C17.379 19.5 18.5 18.379 18.5 17C18.5 15.621 17.379 14.5 16 14.5H13.5V13H16C18.209 13 20 14.791 20 17Z" fill="white"/>
</svg>`
	case model.LanguageRust:
		return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="32" height="32" rx="8" fill="black"/>
<path d="M19.812 18.968C19.812 18.968 21.562 18.968 21.562 17.218C21.562 15.468 19.812 15.468 19.812 15.468H16.375V20.718H19.812C19.812 20.718 21.562 20.718 21.562 18.968C21.562 18.968 19.812 18.968 19.812 18.968ZM19.812 16.718C19.812 16.718 20.562 16.718 20.562 17.218C20.562 17.718 19.812 17.718 19.812 17.718H17.625V16.718H19.812Z" fill="white"/>
<path d="M13.875 15.468C12.125 15.468 10.375 17.218 10.375 18.968C10.375 20.718 12.125 22.468 13.875 22.468C15.625 22.468 17.375 20.718 17.375 18.968C17.375 17.218 15.625 15.468 13.875 15.468ZM13.875 20.968C12.875 20.968 12.125 20.218 12.125 19.218C12.125 18.218 12.875 17.468 13.875 17.468C14.875 17.468 15.625 18.218 15.625 19.218C15.625 20.218 14.875 20.968 13.875 20.968Z" fill="white"/>
<path d="M22.312 15.468C20.562 15.468 18.812 17.218 18.812 18.968C18.812 20.718 20.562 22.468 22.312 22.468C24.062 22.468 25.812 20.718 25.812 18.968C25.812 17.218 24.062 15.468 22.312 15.468ZM22.312 20.968C21.312 20.968 20.562 20.218 20.562 19.218C20.562 18.218 21.312 17.468 22.312 17.468C23.312 17.468 24.062 18.218 24.062 19.218C24.062 20.218 23.312 20.968 22.312 20.968Z" fill="white"/>
<path d="M14.875 19.218C14.875 19.772 14.428 20.218 13.875 20.218C13.322 20.218 12.875 19.772 12.875 19.218C12.875 18.665 13.322 18.218 13.875 18.218C14.428 18.218 14.875 18.665 14.875 19.218Z" fill="black"/>
<path d="M23.312 19.218C23.312 19.772 22.865 20.218 22.312 20.218C21.759 20.218 21.312 19.772 21.312 19.218C21.312 18.665 21.759 18.218 22.312 18.218C22.865 18.218 23.312 18.665 23.312 19.218Z" fill="black"/>
</svg>`
	case model.LanguageKotlin:
		return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6 6H26V26H6V6Z" fill="#7F52FF"/>
<path d="M6 6L16 16L26 6H6Z" fill="#7F52FF"/>
<path d="M16 16L6 26L16 26L26 16L16 16Z" fill="#7F52FF"/>
<path d="M16 16L16 26L6 26L16 16Z" fill="#7F52FF"/>
<path d="M16 16L26 6V16L16 26L16 16Z" fill="#7F52FF"/>
<path d="M16 16L26 16L16 26L16 16Z" fill="#7F52FF"/>
</svg>`
	case model.LanguageSwift:
		return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M22.5 7C22.5 7 25.5 10.5 25.5 14.5C25.5 18.5 22.5 21.5 18.5 21.5C14.5 21.5 11.5 18.5 11.5 18.5C11.5 18.5 14.5 15.5 14.5 12.5C14.5 9.5 17.5 7 17.5 7C17.5 7 16.5 9 16.5 11.5C16.5 14 18.5 16 20.5 16C22.5 16 22.5 14.5 22.5 14.5C22.5 14.5 23.5 16 24.5 16C25.5 16 25.5 14.5 25.5 14.5C25.5 14.5 26.5 12 24.5 10C22.5 8 22.5 7 22.5 7Z" fill="#F05138"/>
<path d="M7 18C7 18 10 21.5 14 21.5C18 21.5 21 18.5 21 18.5C21 18.5 18 15.5 18 12.5C18 9.5 15 7 15 7C15 7 14 9 14 11.5C14 14 12 16 10 16C8 16 7 14.5 7 14.5C7 14.5 6 16 5 16C4 16 4 14.5 4 14.5C4 14.5 5 12 7 10C9 8 7 7 7 7C7 7 4 10.5 4 14.5C4 18.5 7 21.5 11 21.5C15 21.5 18 18.5 18 18.5C18 18.5 15 15.5 15 12.5C15 9.5 18 7 18 7C18 7 17 9 17 11.5C17 14 19 16 21 16C23 16 24 14.5 24 14.5C24 14.5 25 16 26 16C27 16 27 14.5 27 14.5C27 14.5 26 12 24 10C22 8 22 7 22 7C22 7 25 10.5 25 14.5C25 18.5 22 21.5 18 21.5C14 21.5 11 18.5 11 18.5C11 18.5 14 15.5 14 12.5C14 9.5 11 7 11 7C11 7 12 9 12 11.5C12 14 10 16 8 16C6 16 5 14.5 5 14.5C5 14.5 4 16 3 16C2 16 2 14.5 2 14.5C2 14.5 3 12 5 10C7 8 7 7 7 7Z" fill="white"/>
</svg>`
	case model.LanguageTypeScript:
		return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="32" height="32" rx="8" fill="#3178C6"/>
<path d="M22.5 18.5V17.5H19.5V9.5H18V17.5H15V18.5H18V20.5H15V21.5H18V25.5H19.5V21.5H22.5V20.5H19.5V18.5H22.5Z" fill="white"/>
<path d="M10.5 9.5V21.5H12V17.5H14.5C16.156 17.5 17.5 16.156 17.5 14.5C17.5 12.844 16.156 11.5 14.5 11.5H10.5V9.5ZM12 12.5H14.5C15.328 12.5 16 13.172 16 14.5C16 15.828 15.328 16.5 14.5 16.5H12V12.5Z" fill="white"/>
</svg>`
	default:
		return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="32" height="32" rx="8" fill="#ccc"/>
<text x="16" y="21" text-anchor="middle" font-family="Arial" font-size="18" font-weight="bold" fill="#333">?</text>
</svg>`
	}
}
